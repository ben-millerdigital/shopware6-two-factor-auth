(this.webpackJsonp=this.webpackJsonp||[]).push([["rune-laenen-two-factor-auth"],{"4Z/q":function(e){e.exports=JSON.parse('{"rl-2fa":{"sw-login":{"index":{"labelOtp":"2FA Token"}},"settings":{"user-detail":{"title":"Twee-factorauthenticatie","enabled":{"title":"Twee-factorauthenticatie is ingeschakeld","description":"Proficiat! Je account is veilig! Klik op onderstaande knop om 2FA uit te zetten.","disable":"Zet 2FA uit"},"not-enabled":{"title":"Twee-factorauthenticatie is uitgeschakeld","description":"Twee-factorauthenticatie is niet actief voor jouw account. Klik op onderstaande knop om 2FA aan te zetten.","get-started":"2FA instellen"},"generating":{"scan-code":"Scan de code links met jouw 2FA app.","description":"Vul je One Time Password token in, en klik op \'Valideer & sla op\' om de token na te kijken. Als de code correct is wordt 2FA aangezet voor jouw account.","error-title":"Er ging iets mis.","validate-save":"Valideer & sla op"}}}}}')},"9Xy8":function(e,t){e.exports='{% block sw_profile_index_info_card %}\n    {% parent %}\n    <rl-user-otp :user="user" :isLoading="isLoading" :onSave="onSave"></rl-user-otp>\n{% endblock %}\n'},Dgst:function(e,t){e.exports='{% block sw_setting_user_detail_card_integrations %}\n    <rl-user-otp :user="user" :isLoading="isLoading" :onSave="onSave"></rl-user-otp>\n    {% parent %}\n{% endblock %}\n'},F7oZ:function(e){e.exports=JSON.parse('{"rl-2fa":{"sw-login":{"index":{"labelOtp":"2FA Token"}},"settings":{"user-detail":{"title":"Two factor authentication","enabled":{"title":"Two factor authentication is enabled","description":"Congrats! You\'re secure! To disable 2FA for your account, click the button below.","disable":"Disable 2FA"},"not-enabled":{"title":"Two factor authentication is not enabled","description":"Two factor authentication is not enabled for your account. Click the button below to set it up.","get-started":"Click me to get started"},"generating":{"scan-code":"Scan the code on the left with your 2FA app.","description":"Fill in your One Time Password and click \'Validate & enable\' to check the code and enable 2FA for your admin account.","error-title":"Something went wrong","validate-save":"Validate & save"}}}}}')},IrPS:function(e,t,n){"use strict";n.r(t);var s=n("F7oZ"),i=n("4Z/q"),o=n("dRPi"),a=n.n(o);n("SJrS");const{Component:r}=Shopware;r.register("rl-user-otp",{template:a.a,props:{user:{type:Object,required:!0},isLoading:{type:Boolean,required:!0},onSave:{type:Function,required:!0}},data:()=>({httpClient:null,isLoading2Fa:!1,generatedSecret:null,generatedSecretUrl:null,oneTimePassword:"",oneTimePasswordError:""}),created(){this.syncService=Shopware.Service("syncService"),this.httpClient=this.syncService.httpClient},methods:{generateSecret(){this.isLoading2Fa=!0,this.httpClient.get("rl-2fa/generate-secret",{params:{holder:this.user.username}}).then((e=>{this.isLoading2Fa=!1,this.generatedSecret=e.data.secret,this.generatedSecretUrl=e.data.qrUrl}))},validateAndSaveOneTimePassword(){this.isLoading2Fa=!0,this.httpClient.post("rl-2fa/validate-secret",{secret:this.generatedSecret,code:this.oneTimePassword}).then((e=>{this.isLoading2Fa=!1,"OK"===e.data.status&&this.saveOneTimePassword()})).catch((e=>{this.isLoading2Fa=!1,this.oneTimePasswordError=e.response.data.error}))},saveOneTimePassword(){this.user.customFields||this.$set(this.user,"customFields",{}),this.user.customFields.rl_2fa_secret=this.generatedSecret,this.onSave()},disable2FA(){this.user.customFields||this.$set(this.user,"customFields",{}),this.user.customFields.rl_2fa_secret="",this.onSave()}}});var l=n("OAEW"),d=n.n(l);const{Component:c,Context:u,Application:p}=Shopware;c.override("sw-login-login",{template:d.a,data:()=>({rememberOtpPassword:"",showOtpForm:!1,otp:""}),methods:{loginUserWithPasswordAndOtp(){return this.$emit("is-loading"),this.loginWithOtp(this.username,this.password,this.otp).then((()=>{this.handleLoginSuccess(),this.$emit("is-not-loading")})).catch((e=>{this.password="",this.showOtpForm=!1,this.handleLoginError(e),this.$emit("is-not-loading")}))},loginWithOtp(e,t,n){return p.getContainer("init").httpClient.post("/oauth/token",{grant_type:"password",client_id:"administration",scopes:"write",username:e,password:t,rl_2fa_otp:n},{baseURL:u.api.apiPath}).then((e=>{const t=this.loginService.setBearerAuthentication({access:e.data.access_token,refresh:e.data.refresh_token,expiry:e.data.expires_in});return window.localStorage.setItem("redirectFromLogin","true"),t}))},loginUserWithPassword(){this.rememberOtpPassword=this.password,this.$super("loginUserWithPassword")},handleLoginError(e){"request-otp"===e.response.data.errors[0].detail?(this.password=this.rememberOtpPassword,this.showOtpForm=!0):this.$super("handleLoginError",e)}}});var h=n("9Xy8"),g=n.n(h);const{Component:w}=Shopware;w.getComponentRegistry().has("sw-profile-index")&&w.override("sw-profile-index",{template:g.a});var m=n("Dgst"),b=n.n(m);const{Component:f}=Shopware;f.getComponentRegistry().has("sw-users-permissions-user-detail")&&f.override("sw-users-permissions-user-detail",{template:b.a});var v=n("dkjO"),_=n.n(v);const{Component:F}=Shopware;F.getComponentRegistry().has("sw-customer-base-info")&&F.override("sw-customer-base-info",{template:_.a,computed:{twoFactorAuthenticationActive(){return!!this.customer.customFields&&!!this.customer.customFields.rl_2fa_secret}},methods:{disable2FA(){this.customer.customFields||this.$set(this.customer,"customFields",{}),this.customer.customFields.rl_2fa_secret=""}}}),Shopware.Locale.extend("en-GB",s),Shopware.Locale.extend("nl-NL",i)},OAEW:function(e,t){e.exports='{% block sw_login_login %}\n\n    <div v-if="!showOtpForm">\n        {% parent %}\n    </div>\n    <div v-else>\n        <form class="sw-login-login sw-login-login-otp" @submit.prevent="loginUserWithPasswordAndOtp">\n            <h2 class="sw-login__content-headline">{{ $tc(\'sw-login.index.headlineForm\') }}</h2>\n\n            <sw-text-field\n                v-autofocus\n                v-model="otp"\n                :label="$tc(\'rl-2fa.sw-login.index.labelOtp\')"\n                required>\n            </sw-text-field>\n\n            <div class="sw-login__submit">\n                <sw-button :disabled="otp.length != 6 || password.length <= 0 || username.length <= 0"\n                           class="sw-login__login-action"\n                           variant="primary">\n                    {{ $tc(\'sw-login.index.buttonLogin\') }}\n                </sw-button>\n            </div>\n        </form>\n    </div>\n{% endblock %}\n'},SJrS:function(e,t,n){var s=n("XApA");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,n("SZ7m").default)("8b9f8d88",s,!0,{})},XApA:function(e,t,n){},dRPi:function(e,t){e.exports='{% block rl_user_otp_user_card %}\n    <sw-card :title="$tc(\'rl-2fa.settings.user-detail.title\')"\n             :is-loading="isLoading || isLoading2Fa">\n        <div v-if="user && user.customFields && user.customFields.rl_2fa_secret">\n\n            <sw-alert variant="success"\n                      :title="$tc(\'rl-2fa.settings.user-detail.enabled.title\')"\n                      style="margin-bottom: 0;"\n                      :showIcon="true"\n                      :closable="false">\n                {{ $tc(\'rl-2fa.settings.user-detail.enabled.description\') }}\n\n                <template v-slot:actions>\n                    <sw-button @click="disable2FA">{{ $tc(\'rl-2fa.settings.user-detail.enabled.disable\') }}</sw-button>\n                </template>\n            </sw-alert>\n        </div>\n        <div v-else-if="!generatedSecretUrl">\n            <sw-alert variant="warning"\n                      :title="$tc(\'rl-2fa.settings.user-detail.not-enabled.title\')"\n                      style="margin-bottom: 0;"\n                      :showIcon="true"\n                      :closable="false">\n                {{ $tc(\'rl-2fa.settings.user-detail.not-enabled.description\') }}\n\n                <template v-slot:actions>\n                    <sw-button @click="generateSecret">{{ $tc(\'rl-2fa.settings.user-detail.not-enabled.get-started\') }}</sw-button>\n                </template>\n            </sw-alert>\n        </div>\n        <div v-else-if="generatedSecretUrl">\n            <sw-container columns="1fr 1fr">\n                <div class="rl-2fa-qr-code">\n                    <img :src="generatedSecretUrl" />\n                    <span class="rl-2fa-qr-code--secret">{{ generatedSecret }}</span>\n                </div>\n                <div>\n                    <b>{{ $tc(\'rl-2fa.settings.user-detail.generating.scan-code\') }}</b><br />\n                    <br />\n                    {{ $tc(\'rl-2fa.settings.user-detail.generating.description\') }}<br />\n                    <br />\n                    <sw-alert variant="error"\n                              :title="$tc(\'rl-2fa.settings.user-detail.generating.error-title\')"\n                              :showIcon="true"\n                              v-if="oneTimePasswordError.length > 0">\n                        {{ oneTimePasswordError }}\n                    </sw-alert>\n\n                    <sw-text-field label="One-time Password"\n                                   :isInvalid="oneTimePasswordError.length > 0"\n                                   v-model="oneTimePassword"\n                                   autocomplete="one-time-code"></sw-text-field>\n\n                    <sw-button @click="validateAndSaveOneTimePassword">\n                        {{ $tc(\'rl-2fa.settings.user-detail.generating.validate-save\') }}\n                    </sw-button>\n                </div>\n            </sw-container>\n        </div>\n    </sw-card>\n{% endblock %}\n'},dkjO:function(e,t){e.exports='{% block sw_customer_base_metadata_active %}\n    {% parent %}\n    <sw-description-list>\n        {% block sw_customer_base_metadata_2fa_label %}\n            <dt class="sw-customer-base-info__label">{{ $tc(\'rl-2fa.settings.user-detail.title\') }}</dt>\n        {% endblock %}\n\n        {% block sw_customer_base_metadata_2fa_content %}\n            <dd v-if="!customerEditMode || !twoFactorAuthenticationActive" class="sw-customer-base__label-is-active">\n                {{ $tc(\'sw-customer.baseInfo.contentActive\', twoFactorAuthenticationActive) }}\n            </dd>\n        {% endblock %}\n\n        {% block sw_customer_base_metadata_2fa_editor %}\n            <dd v-else>\n                <sw-button if="twoFactorAuthenticationActive" @click="disable2FA">{{ $tc(\'rl-2fa.settings.user-detail.enabled.disable\') }}</sw-button>\n            </dd>\n        {% endblock %}\n    </sw-description-list>\n{% endblock %}\n'}},[["IrPS","runtime","vendors-node"]]]);